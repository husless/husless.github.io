<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="人生得意须尽欢， 莫使金樽空对月" />



  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="人生得意须尽欢， 莫使金樽空对月">
<meta property="og:type" content="website">
<meta property="og:title" content="草原上的狼">
<meta property="og:url" content="https://husless.github.io/index.html">
<meta property="og:site_name" content="草原上的狼">
<meta property="og:description" content="人生得意须尽欢， 莫使金樽空对月">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="草原上的狼">
<meta name="twitter:description" content="人生得意须尽欢， 莫使金樽空对月">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'hide'
  };
</script>

  <title> 草原上的狼 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">草原上的狼</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/07/shell-variables-operations/" itemprop="url">
                Shell Variables Operations
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-10-07T18:00:24+08:00" content="2015-10-07">
            2015-10-07
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Linux/" itemprop="url" rel="index">
                  <span itemprop="name">Linux</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/10/07/shell-variables-operations/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/10/07/shell-variables-operations/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>Shell 变量的值，可以通过简单的动作来进行删除、替换。</p>
<h1 id="变量内容的删除">变量内容的删除</h1><p>假如需要对 Shell 变量的内容进行部分删除，删除的动作可以从前往后删，也可以从后往前删。语法如下：</p>
<table>
<thead>
<tr>
<th>语法表达式</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>${variable#pattern}</code></td>
<td>若变量内容从前向后匹配 pattern，则将匹配的最短的内容删除，类似正则表达式的非贪婪匹配</td>
</tr>
<tr>
<td><code>${variable##pattern}</code></td>
<td>若变量内容从前向后匹配 pattern，则将匹配的最长的内容删除，类似正则表达式的贪婪匹配</td>
</tr>
<tr>
<td><code>${variable%pattern}</code></td>
<td>若变量内容从后向前匹配 pattern，则将匹配的最短的内容删除，类似正则表达式的非贪婪匹配</td>
</tr>
<tr>
<td><code>${variable%%pattern}</code></td>
<td>若变量内容从后向前匹配 pattern，则将匹配的最长的内容删除，类似正则表达式的贪婪匹配</td>
</tr>
</tbody>
</table>
<p>在此，以命令 <code>latex</code> 的绝对路径 <code>/usr/local/texlive/2015/bin/x86_64-linux/latex</code> 来进行实验。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ path=$(<span class="built_in">which</span> latex)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;path&#125;</span></span><br><span class="line">/usr/<span class="built_in">local</span>/texlive/<span class="number">2015</span>/bin/x86_64-linux/latex</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;path#/*/&#125;</span>      <span class="comment"># 从前向后，最短匹配，only 最前面的`/`</span></span><br><span class="line">usr/<span class="built_in">local</span>/texlive/<span class="number">2015</span>/bin/x86_64-linux/latex</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;path##/*/&#125;</span>     <span class="comment"># 从前向后，最长匹配，只剩下最后面的 `latex`</span></span><br><span class="line">latex</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;path%/*&#125;</span>       <span class="comment"># 从后向前，最短匹配</span></span><br><span class="line">/usr/<span class="built_in">local</span>/texlive/<span class="number">2015</span>/bin/x86_64-linux</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;path%%/local*&#125;</span> <span class="comment"># 从后向前，最长匹配</span></span><br><span class="line">/usr</span><br></pre></td></tr></table></figure>
<h1 id="变量内容替换">变量内容替换</h1><p>替换语法：</p>
<table>
<thead>
<tr>
<th>语法表达式</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>${variable/old/new}</code></td>
<td>从前向后匹配，将遇到的第一个 <code>old</code> 替换成 <code>new</code></td>
</tr>
<tr>
<td><code>${variable//old/new}</code></td>
<td>从前向后匹配，将所有陪陪的 <code>old</code> 替换为 <code>new</code></td>
</tr>
</tbody>
</table>
<p>以 <code>$PATH</code> 举例，将 <code>bin</code> 替换为大写的 <code>BIN</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ path=<span class="variable">$&#123;PATH&#125;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;path&#125;</span></span><br><span class="line">/opt/mpich-install/bin:/usr/<span class="built_in">local</span>/texlive/<span class="number">2015</span>/bin/x86_64-linux:/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/<span class="built_in">local</span>/games</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;path/bin/BIN&#125;</span>  <span class="comment"># 只替换了第一个</span></span><br><span class="line">/opt/mpich-install/BIN/:/usr/<span class="built_in">local</span>/texlive/<span class="number">2015</span>/bin/x86_64-linux:/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/<span class="built_in">local</span>/games</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;path//bin/BIN&#125;</span> <span class="comment"># 全部替换</span></span><br><span class="line">/opt/mpich-install/BIN:/usr/<span class="built_in">local</span>/texlive/<span class="number">2015</span>/BIN//x86_64-linux:/usr/<span class="built_in">local</span>/sBIN:/usr/<span class="built_in">local</span>/BIN:/usr/sBIN:/usr/BIN:/sBIN:/BIN:/usr/games:/usr/<span class="built_in">local</span>/games</span><br></pre></td></tr></table></figure>
<h1 id="变量的测试与内容替换">变量的测试与内容替换</h1><p>某些时候，我们需要检测一下某个变量是否存在，若存在则使用其原有的值，否则给出一个值。虽然，在 Shell Script 中可以用 <code>if...then...</code> 结构来处理，但直接用 <code>bash</code> 提供的内置功能进行测试判断，<br>使得整个程序简洁得多。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="variable">$var</span></span><br><span class="line">                <span class="comment"># &lt;&lt;=== 空行，表示变量 `var` 不存在或者为空字符</span></span><br><span class="line">$ var=<span class="variable">$&#123;var-Linux&#125;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span></span><br><span class="line">Linux</span><br><span class="line">$ var=<span class="string">"Ubuntu Server"</span></span><br><span class="line">$ var=<span class="variable">$&#123;var-Linux&#125;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span></span><br><span class="line">Ubuntu Server</span><br></pre></td></tr></table></figure>
<p>上面的例子中，关键在于减号(-)及其后面的内容，语法格式为 <code>new=${old-default}</code>，其意义为：若变量 <code>old</code> 存在且不为空，则将其内容赋值给变量 <code>new</code>；<br>否则，将给定的 <code>default</code> 赋值给 <code>new</code>。Shell 变量设定语法，还可以将前面语法格式中的 <code>-</code> 改为 <code>:-, +, :+, =, :=, ?, :?</code>，一共 8 种格式，各自的意义为：</p>
<table>
<thead>
<tr>
<th>语法表达式</th>
<th><code>old</code> 不存在</th>
<th><code>old</code> 为空字符串</th>
<th><code>old</code> 存在且不为空</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>new=${old-content}</code></td>
<td><code>new=content</code></td>
<td><code>new=</code></td>
<td><code>new=$old</code></td>
</tr>
<tr>
<td><code>new=${old:-content}</code></td>
<td><code>new=content</code></td>
<td><code>new=content</code></td>
<td><code>new=$old</code></td>
</tr>
<tr>
<td><code>new=${old+content}</code></td>
<td><code>new=</code></td>
<td><code>new=content</code></td>
<td><code>new=content</code></td>
</tr>
<tr>
<td><code>new=${old:+content}</code></td>
<td><code>new=</code></td>
<td><code>new=</code></td>
<td><code>new=content</code></td>
</tr>
<tr>
<td><code>new=${old=content}</code></td>
<td><code>old=content</code>, <code>new=content</code></td>
<td><code>old</code> 不变，<code>new=</code></td>
<td><code>old</code> 不变，<code>new=$old</code></td>
</tr>
<tr>
<td><code>new=${old:=content}</code></td>
<td><code>old=content</code>, <code>new=content</code></td>
<td><code>old=content</code>, <code>new=content</code></td>
<td><code>old</code> 不变，<code>new=$old</code></td>
</tr>
<tr>
<td><code>new=${old?content}</code></td>
<td><code>content</code> 输出至 <code>stderr</code></td>
<td><code>old=</code></td>
<td><code>new=$old</code></td>
</tr>
<tr>
<td><code>new=${old:?content}</code></td>
<td><code>content</code> 输出至 <code>stderr</code></td>
<td><code>content</code> 输出至 <code>stderr</code></td>
<td><code>new=$old</code></td>
</tr>
</tbody>
</table>
<p>Reference:<br><a href="http://linux.vbird.org/linux_basic/0320bash.php#variable_other" target="_blank" rel="external">鸟哥的 Linux 私房菜</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/01/configure-nginx-with-http2-support/" itemprop="url">
                Configure Nginx with HTTP/2 Support
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-10-01T14:34:48+08:00" content="2015-10-01">
            2015-10-01
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Nginx/" itemprop="url" rel="index">
                  <span itemprop="name">Nginx</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/10/01/configure-nginx-with-http2-support/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/10/01/configure-nginx-with-http2-support/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>刚发布不久的 Nginx 1.9.5 正式支持HTTP/2，于是就来折腾一番吧。由于 HTTP/2 是基于 https， 因此必须先配置 Nginx 支持 https。文中所有操作都在自己本地机器上进行测试，采用的是 <code>openssl</code> 生成自签名证书。</p>
<ol>
<li><p>创建 Key：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl genrsa -des3 -out test.key <span class="number">1024</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建签名请求：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl req -new -subj <span class="string">"/C=US/ST=Mars/L=iTranswarp/O=iTranswarp/OU=iTranswrap/CN=test"</span> -key test.key -out test.csr</span><br></pre></td></tr></table></figure>
<p>在实际部署时，必须将 CN 字段中的 <code>test</code> 换成域名，否则无法通过浏览器验证。</p>
</li>
<li><p>将 Key 的口令移除：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mv test.key test.origin.key</span><br><span class="line">$ openssl rsa -in test.origin.key -out test.key</span><br></pre></td></tr></table></figure>
</li>
<li><p>用Key签名证书:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl x509 -req -days <span class="number">3650</span> -in test.csr -signkey test.key -out test.crt</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 Nginx</p>
<ul>
<li>重定向所有的流量到 SSL/TLS</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    location / &#123;</span><br><span class="line">            <span class="built_in">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>启用 HTTP/2</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen              <span class="number">443</span> ssl http2 default_server;</span><br><span class="line">    server_name         localhost;</span><br><span class="line">    keeplive_timeout    <span class="number">70</span>;</span><br><span class="line"></span><br><span class="line">    ssl_certificate     /path/to/test.crt;</span><br><span class="line">    ssl_certificate_key /path/to/test.key;</span><br><span class="line">    ssl_session_cache   shared:SSL:<span class="number">10</span>m;</span><br><span class="line">    ssl_session_timeout <span class="number">10</span>m;</span><br><span class="line">    ssl_protocols       TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    ssl_ciphers         <span class="string">'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA'</span>;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新加载配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nginx -t   <span class="comment"># 检验配置文件是否有错误</span></span><br><span class="line">$ sudo nginx <span class="operator">-s</span> reload</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Refferences:</p>
<ol>
<li><a href="https://www.nginx.com/blog/nginx-1-9-5/" target="_blank" rel="external">https://www.nginx.com/blog/nginx-1-9-5/</a></li>
<li><a href="http://www.liaoxuefeng.com/article/0014189023237367e8d42829de24b6eaf893ca47df4fb5e000" target="_blank" rel="external">http://www.liaoxuefeng.com/article/0014189023237367e8d42829de24b6eaf893ca47df4fb5e000</a></li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/21/advanced-data-structure-in-python/" itemprop="url">
                Advanced Data Structure in Python
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-09-21T21:22:24+08:00" content="2015-09-21">
            2015-09-21
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Python/" itemprop="url" rel="index">
                  <span itemprop="name">Python</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/09/21/advanced-data-structure-in-python/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/09/21/advanced-data-structure-in-python/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>对于 Python 中内置的 <code>list, tuple, set and dict</code> 这样的简单数据结构，我们已经很熟悉了。<br>一般的应用场景，有这些简单的数据结构，也已经够用了。如果是比较复杂的场景，需要其他更高级的<br>数据结构，Python 也为我们提供了支持。本文先学习如下几种：</p>
<ul>
<li>collections</li>
<li>array</li>
<li>heapq</li>
<li>bisect</li>
<li>weakref</li>
<li>copy</li>
<li>pprint</li>
<li>singly linked-list</li>
</ul>
<h2 id="Collections">Collections</h2><p>在 <code>collections</code> 模块中，包含了一些非常有用的数据结构，比如 <code>Counter, defaultdict, OrderedDict,
deque, namedtuple</code> 等，其中最常用的就是 <code>Counter, deque, defaultdict</code>。<code>Counter</code> 顾名思义，是一个计数器，<br>继承自内置的 <code>dict</code>，常用的方法除了与 <code>dict</code> 相应的方法之外，就是 <code>most_common</code> 了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>Counter([<span class="string">'A'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'A'</span>])</span><br><span class="line">Counter(&#123;<span class="string">'A'</span>: <span class="number">3</span>, <span class="string">'C'</span>: <span class="number">2</span>, <span class="string">'B'</span>: <span class="number">2</span>, <span class="string">'D'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d = Counter([<span class="string">'A'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'A'</span>])</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d.most_common(<span class="number">3</span>)</span><br><span class="line">[(<span class="string">'A'</span>, <span class="number">3</span>), (<span class="string">'C'</span>, <span class="number">2</span>), (<span class="string">'B'</span>, <span class="number">2</span>)]</span><br></pre></td></tr></table></figure>
<p>下面这段代码，用于统计一段文本中每个单词的使用频率：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>string = <span class="string">"""The Zen of Python, by Tim Peters</span><br><span class="line"><span class="prompt">... </span></span><br><span class="line"><span class="prompt">... </span>Beautiful is better than ugly.</span><br><span class="line"><span class="prompt">... </span>Explicit is better than implicit.</span><br><span class="line"><span class="prompt">... </span>Simple is better than complex.</span><br><span class="line"><span class="prompt">... </span>Complex is better than complicated.</span><br><span class="line"><span class="prompt">... </span>Flat is better than nested.</span><br><span class="line"><span class="prompt">... </span>Sparse is better than dense.</span><br><span class="line"><span class="prompt">... </span>Readability counts.</span><br><span class="line"><span class="prompt">... </span>Special cases aren't special enough to break the rules.</span><br><span class="line"><span class="prompt">... </span>Although practicality beats purity.</span><br><span class="line"><span class="prompt">... </span>Errors should never pass silently.</span><br><span class="line"><span class="prompt">... </span>Unless explicitly silenced.</span><br><span class="line"><span class="prompt">... </span>In the face of ambiguity, refuse the temptation to guess.</span><br><span class="line"><span class="prompt">... </span>There should be one-- and preferably only one --obvious way to do it.</span><br><span class="line"><span class="prompt">... </span>Although that way may not be obvious at first unless you're Dutch.</span><br><span class="line"><span class="prompt">... </span>Now is better than never.</span><br><span class="line"><span class="prompt">... </span>Although never is often better than *right* now.</span><br><span class="line"><span class="prompt">... </span>If the implementation is hard to explain, it's a bad idea.</span><br><span class="line"><span class="prompt">... </span>If the implementation is easy to explain, it may be a good idea.</span><br><span class="line"><span class="prompt">... </span>Namespaces are one honking great idea -- let's do more of those!</span><br><span class="line"><span class="prompt">... </span>"""</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">import</span> re</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>words = [w <span class="keyword">for</span> w <span class="keyword">in</span> re.split(re.compile(<span class="string">r'[ \n,\.\*-]'</span>), string) <span class="keyword">if</span> w]</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>rate = Counter(words)</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>rate.most_common(<span class="number">10</span>)</span><br><span class="line">[(<span class="string">'is'</span>, <span class="number">10</span>), (<span class="string">'better'</span>, <span class="number">8</span>), (<span class="string">'than'</span>, <span class="number">8</span>), (<span class="string">'to'</span>, <span class="number">5</span>), (<span class="string">'the'</span>, <span class="number">5</span>), (<span class="string">'idea'</span>, <span class="number">3</span>), (<span class="string">'be'</span>, <span class="number">3</span>), (<span class="string">'never'</span>, <span class="number">3</span>), (<span class="string">'of'</span>, <span class="number">3</span>), (<span class="string">'one'</span>, <span class="number">3</span>)]</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>Counter(&#123;<span class="string">'is'</span>: <span class="number">10</span>, <span class="string">'better'</span>: <span class="number">8</span>, <span class="string">'than'</span>: <span class="number">8</span>, <span class="string">'to'</span>: <span class="number">5</span>, <span class="string">'the'</span>: <span class="number">5</span>, <span class="string">'idea'</span>: <span class="number">3</span>, <span class="string">'be'</span>: <span class="number">3</span>, <span class="string">'never'</span>: <span class="number">3</span>, <span class="string">'of'</span>: <span class="number">3</span>, <span class="string">'one'</span>: <span class="number">3</span>, <span class="string">'Although'</span>: <span class="number">3</span>, <span class="string">'implementation'</span>: <span class="number">2</span>, <span class="string">'explain'</span>: <span class="number">2</span>, <span class="string">'should'</span>: <span class="number">2</span>, <span class="string">'do'</span>: <span class="number">2</span>, <span class="string">'way'</span>: <span class="number">2</span>, <span class="string">'obvious'</span>: <span class="number">2</span>, <span class="string">'it'</span>: <span class="number">2</span>, <span class="string">'may'</span>: <span class="number">2</span>, <span class="string">'a'</span>: <span class="number">2</span>, <span class="string">'If'</span>: <span class="number">2</span>, <span class="string">'Errors'</span>: <span class="number">1</span>, <span class="string">'nested'</span>: <span class="number">1</span>, <span class="string">'only'</span>: <span class="number">1</span>, <span class="string">'explicitly'</span>: <span class="number">1</span>, <span class="string">'easy'</span>: <span class="number">1</span>, <span class="string">'Now'</span>: <span class="number">1</span>, <span class="string">'good'</span>: <span class="number">1</span>, <span class="string">'rules'</span>: <span class="number">1</span>, <span class="string">'Explicit'</span>: <span class="number">1</span>, <span class="string">'break'</span>: <span class="number">1</span>, <span class="string">'not'</span>: <span class="number">1</span>, <span class="string">'now'</span>: <span class="number">1</span>, <span class="string">'Simple'</span>: <span class="number">1</span>, <span class="string">'bad'</span>: <span class="number">1</span>, <span class="string">'silently'</span>: <span class="number">1</span>, <span class="string">'right'</span>: <span class="number">1</span>, <span class="string">'often'</span>: <span class="number">1</span>, <span class="string">'hard'</span>: <span class="number">1</span>, <span class="string">'Complex'</span>: <span class="number">1</span>, <span class="string">'are'</span>: <span class="number">1</span>, <span class="string">'pass'</span>: <span class="number">1</span>, <span class="string">'special'</span>: <span class="number">1</span>, <span class="string">'Flat'</span>: <span class="number">1</span>, <span class="string">'dense'</span>: <span class="number">1</span>, <span class="string">'temptation'</span>: <span class="number">1</span>, <span class="string">'enough'</span>: <span class="number">1</span>, <span class="string">'Namespaces'</span>: <span class="number">1</span>, <span class="string">'complicated'</span>: <span class="number">1</span>, <span class="string">'Sparse'</span>: <span class="number">1</span>, <span class="string">"aren't"</span>: <span class="number">1</span>, <span class="string">'by'</span>: <span class="number">1</span>, <span class="string">'great'</span>: <span class="number">1</span>, <span class="string">'those!'</span>: <span class="number">1</span>, <span class="string">'first'</span>: <span class="number">1</span>, <span class="string">'There'</span>: <span class="number">1</span>, <span class="string">'counts'</span>: <span class="number">1</span>, <span class="string">"you're"</span>: <span class="number">1</span>, <span class="string">'guess'</span>: <span class="number">1</span>, <span class="string">'Unless'</span>: <span class="number">1</span>, <span class="string">"it's"</span>: <span class="number">1</span>, <span class="string">'implicit'</span>: <span class="number">1</span>, <span class="string">'ambiguity'</span>: <span class="number">1</span>, <span class="string">'more'</span>: <span class="number">1</span>, <span class="string">'that'</span>: <span class="number">1</span>, <span class="string">'cases'</span>: <span class="number">1</span>, <span class="string">'Beautiful'</span>: <span class="number">1</span>, <span class="string">'honking'</span>: <span class="number">1</span>, <span class="string">'practicality'</span>: <span class="number">1</span>, <span class="string">'ugly'</span>: <span class="number">1</span>, <span class="string">'Special'</span>: <span class="number">1</span>, <span class="string">'at'</span>: <span class="number">1</span>, <span class="string">'and'</span>: <span class="number">1</span>, <span class="string">'Peters'</span>: <span class="number">1</span>, <span class="string">'Tim'</span>: <span class="number">1</span>, <span class="string">'beats'</span>: <span class="number">1</span>, <span class="string">'purity'</span>: <span class="number">1</span>, <span class="string">'Dutch'</span>: <span class="number">1</span>, <span class="string">'preferably'</span>: <span class="number">1</span>, <span class="string">'Python'</span>: <span class="number">1</span>, <span class="string">'silenced'</span>: <span class="number">1</span>, <span class="string">'complex'</span>: <span class="number">1</span>, <span class="string">'Readability'</span>: <span class="number">1</span>, <span class="string">'unless'</span>: <span class="number">1</span>, <span class="string">"let's"</span>: <span class="number">1</span>, <span class="string">'The'</span>: <span class="number">1</span>, <span class="string">'refuse'</span>: <span class="number">1</span>, <span class="string">'Zen'</span>: <span class="number">1</span>, <span class="string">'face'</span>: <span class="number">1</span>, <span class="string">'In'</span>: <span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Deque">Deque</h2><p>Python 中 <code>deque</code> 是双端队列，可以从前后两端添加或删除元素，且都是线程安全的，时间复杂的都近似<code>O(1)</code>。<br>虽然 <code>list</code> 也都支持类似的操作，但 <code>list</code> 内部为固定长度的列表操作做了优化，而且对 <code>list</code> 执行 <code>pop(0)</code><br>和 <code>insert(0, value)</code> 会在内存中移动原来的整个 <code>list</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">!/usr/bin/env python -tt</span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line">n = <span class="number">10</span> ** <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timeit</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="decorator">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorated</span><span class="params">(c)</span>:</span></span><br><span class="line">        t0 = time.time()</span><br><span class="line">        func(c)</span><br><span class="line">        t1 = time.time()</span><br><span class="line">        print(<span class="string">'&#123;0:&lt;30&#125; &#123;1:&lt;20&#125; &#123;2:&lt;20&#125;'</span>.format(type(c), func.__name__, t1-t0))</span><br><span class="line">    <span class="keyword">return</span> decorated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="decorator">@timeit</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        c.append(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="decorator">@timeit</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">append_left</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(c, deque):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            c.appendleft(i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            c.insert(<span class="number">0</span>, i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="decorator">@timeit</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> __ <span class="keyword">in</span> range(n):</span><br><span class="line">        c.pop()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="decorator">@timeit</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pop_left</span><span class="params">(c)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(c, deque):</span><br><span class="line">        <span class="keyword">for</span> __ <span class="keyword">in</span> range(n):</span><br><span class="line">            c.popleft()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> __ <span class="keyword">in</span> range(n):</span><br><span class="line">            c.pop(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'&#123;0:&lt;30&#125; &#123;1:&lt;20&#125; &#123;2:&lt;20&#125;'</span>.format(<span class="string">'type'</span>, <span class="string">'operation'</span>, <span class="string">'time(s)'</span>))</span><br><span class="line">    print(<span class="string">'-'</span> * <span class="number">70</span>)</span><br><span class="line">    <span class="keyword">for</span> container <span class="keyword">in</span> [deque, list]:</span><br><span class="line">        <span class="keyword">for</span> operation <span class="keyword">in</span> [append, append_left, pop, pop_left]:</span><br><span class="line">            c = container(range(n))</span><br><span class="line">            operation(c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test()</span><br></pre></td></tr></table></figure>
<p>其输出结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>                           operation            time(s)             </span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">'collections.deque'</span>&gt;     append               <span class="number">0.0305550098419</span>     </span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">'collections.deque'</span>&gt;     append_left          <span class="number">0.0282950401306</span>     </span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">'collections.deque'</span>&gt;     pop                  <span class="number">0.0276329517365</span>     </span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">'collections.deque'</span>&gt;     pop_left             <span class="number">0.0309929847717</span>     </span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">'list'</span>&gt;                  append               <span class="number">0.0249011516571</span>     </span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">'list'</span>&gt;                  append_left          <span class="number">31.5822160244</span>       </span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">'list'</span>&gt;                  pop                  <span class="number">0.0356750488281</span>     </span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">'list'</span>&gt;                  pop_left             <span class="number">5.80585002899</span></span><br></pre></td></tr></table></figure>
<h2 id="Defaultdict">Defaultdict</h2><p>除了对试图获取一个不存在的键时进行了异常处理(由函数 <code>dafault_factory</code> 提供一个默认值)外，<code>defaultdict</code> 几乎与 Python 内置的 <code>dict</code> 完全一致。</p>
<p>事实上，Python 内置的 <code>dict</code> 也可以通过 <code>setdfault</code> 方法实现类似功能。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>s = <span class="string">'This is a test for defaultdict in Python'</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>words = s.aplit()</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>location = defaultdict(set)</span><br><span class="line"><span class="keyword">for</span> i, w <span class="keyword">in</span> enumerate(words):</span><br><span class="line"><span class="prompt">... </span>    location[w].add(i)</span><br><span class="line"><span class="prompt">... </span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>location</span><br><span class="line">defaultdict(&lt;type <span class="string">'set'</span>&gt;, &#123;<span class="string">'a'</span>: set([<span class="number">2</span>]), <span class="string">'defaultdict'</span>: set([<span class="number">5</span>]), <span class="string">'for'</span>: set([<span class="number">4</span>]), <span class="string">'This'</span>: set([<span class="number">0</span>]), <span class="string">'is'</span>: set([<span class="number">1</span>]), <span class="string">'Python'</span>: set([<span class="number">7</span>]), <span class="string">'in'</span>: set([<span class="number">6</span>]), <span class="string">'test'</span>: set([<span class="number">3</span>])&#125;))</span><br><span class="line"></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="comment"># Use builtin dict</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d = &#123;&#125;</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">for</span> k, v <span class="keyword">in</span> enumerate(words):</span><br><span class="line"><span class="prompt">... </span>    d.setdefault(v, []).append(k)</span><br><span class="line"><span class="prompt">... </span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">'a'</span>: [<span class="number">2</span>], <span class="string">'defaultdict'</span>: [<span class="number">5</span>], <span class="string">'for'</span>: [<span class="number">4</span>], <span class="string">'This'</span>: [<span class="number">0</span>], <span class="string">'is'</span>: [<span class="number">1</span>], <span class="string">'Python'</span>: [<span class="number">7</span>], <span class="string">'in'</span>: [<span class="number">6</span>], <span class="string">'test'</span>: [<span class="number">3</span>]&#125;</span><br></pre></td></tr></table></figure>
<p>通过，扩展内置 <code>dict</code> 的一种实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">MyDict</span><span class="params">(dict)</span>:</span></span><br><span class="line"><span class="prompt">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line"><span class="prompt">... </span>        <span class="keyword">try</span>:</span><br><span class="line"><span class="prompt">... </span>            <span class="keyword">return</span> super(MyDict, self).__getitem__(key)</span><br><span class="line"><span class="prompt">... </span>        <span class="keyword">except</span> KeyError:</span><br><span class="line"><span class="prompt">... </span>            value = self[key] = type(self)()</span><br><span class="line"><span class="prompt">... </span>            <span class="keyword">return</span> value</span><br><span class="line"><span class="prompt">... </span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d = MyDict()</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d[<span class="number">1</span>][<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d[<span class="number">2</span>][<span class="number">3</span>] = <span class="number">6</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d[<span class="number">3</span>][<span class="string">'test'</span>] = <span class="string">'dict'</span></span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="number">1</span>: &#123;<span class="number">2</span>: <span class="number">3</span>&#125;, <span class="number">2</span>: &#123;<span class="number">3</span>: <span class="number">6</span>&#125;, <span class="number">3</span>: &#123;<span class="string">'test'</span>: <span class="string">'dict'</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Array">Array</h2><p>在 <code>array</code> 模块里定义了一种新的数据结构 <code>array</code>，功能长得跟 <code>list</code> 很像，但保存在<br>其中的元素必须是相同类型的，因而在存储效率上大大高于 <code>list</code>。尽管如此，对 <code>array</code><br>的操作都不会比 <code>list</code> 相应的操作快。另外，需要注意的是，当对 <code>array</code> 做列表推导<br>时，会自动将整个 <code>array</code> 转换成 <code>list</code>，而用 <code>generator expression</code> 则可以避免。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>a = array(<span class="string">'i'</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>b = array(a.typecode, (x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> a))</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>a</span><br><span class="line">array(<span class="string">'i'</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>b</span><br><span class="line">array(<span class="string">'i'</span>, [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>])</span><br></pre></td></tr></table></figure>
<p>当 <code>array</code> 的 size 非常大时，对其元素进行就地(in-plaace)操作，很有助于节省存储空间，<br>通常用 <code>enumerate</code> 来实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span>a = array(<span class="string">'i'</span>, range(<span class="number">10000</span>))</span><br><span class="line"><span class="prompt">&gt;&gt;&gt; </span><span class="keyword">for</span> i, x <span class="keyword">in</span> enumerate(a):</span><br><span class="line"><span class="prompt">... </span>    a[i] = x ** <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>对于大 <code>array</code>， 就地修改元素的值，比用 <code>generator expression</code> 创建一个新 <code>array</code><br>大约能快 15% 。</p>
<p>那么，思考一下，何时需要用到 <code>array</code> 呢？</p>
<h2 id="Heapq">Heapq</h2><h2 id="Bisect">Bisect</h2><h2 id="Weakref">Weakref</h2><h2 id="Copy">Copy</h2><h2 id="Pprint">Pprint</h2><h2 id="Singly_Linked-List">Singly Linked-List</h2><p>参考资料：</p>
<ul>
<li><a href="http://docs.python.org/" target="_blank" rel="external">Python Reference</a></li>
<li><a href="http://www.pysnap.com/advanced-data-structures-in-python/" target="_blank" rel="external">http://www.pysnap.com/advanced-data-structures-in-python/</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/09/an-openssl-error-when-upgrade-scrapy/" itemprop="url">
                An Openssl Error When Upgrade Scrapy
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-09-09T00:00:00+08:00" content="2015-09-09">
            2015-09-09
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Linux/" itemprop="url" rel="index">
                  <span itemprop="name">Linux</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/09/09/an-openssl-error-when-upgrade-scrapy/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/09/09/an-openssl-error-when-upgrade-scrapy/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>今天，在更新 Scrapy 时，出现了一个错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">building <span class="string">'_openssl'</span> extension</span><br><span class="line">gcc -pthread -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes <span class="operator">-f</span>PIC <span class="operator">-f</span>PIC -I/usr/<span class="built_in">local</span>/include/python2.<span class="number">7</span> -c build/temp.linux-x86_64-<span class="number">2.7</span>/_openssl.c -o build/temp.linux-x86_64-<span class="number">2.7</span>/build/temp.linux-x86_64-<span class="number">2.7</span>/_openssl.o</span><br><span class="line">gcc -pthread -shared <span class="operator">-f</span>PIC build/temp.linux-x86_64-<span class="number">2.7</span>/build/temp.linux-x86_64-<span class="number">2.7</span>/_openssl.o -lssl -lcrypto -o build/lib.linux-x86_64-<span class="number">2.7</span>/cryptography/hazmat/bindings/_openssl.so</span><br><span class="line">/usr/bin/ld: /usr/<span class="built_in">local</span>/lib/gcc/x86_64-unknown-linux-gnu/<span class="number">5.2</span>.<span class="number">0</span>/../../../../lib64/libssl.a(s2_meth.o): relocation R_X86_64_32 against `.rodata<span class="string">' can not be used when making a shared object; recompile with -fPIC</span><br><span class="line">/usr/local/lib/gcc/x86_64-unknown-linux-gnu/5.2.0/../../../../lib64/libssl.a: error adding symbols: Bad value</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br><span class="line">error: command '</span>gcc<span class="string">' failed with exit status 1</span></span><br></pre></td></tr></table></figure>
<p>很显然，是 openssl 出了问题。于是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo aptitude show openssl</span><br><span class="line">$ openssl version</span><br><span class="line">OpenSSL <span class="number">1.0</span>.<span class="number">2</span>d <span class="number">9</span> Jul <span class="number">2015</span></span><br></pre></td></tr></table></figure>
<p>查看openssl包状态，没有问题啊。再用命令 <code>which openssl</code> 一看，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">which</span> openssl </span><br><span class="line">/usr/<span class="built_in">local</span>/bin/openssl</span><br></pre></td></tr></table></figure>
<p>原来这个版本的 openssl 根本不是系统自带的版本，而系统自带的 openssl 根本没有问题。之前在 nginx 上折腾 HTTP/2 时，自己编译安装了一个新版本的 openssl 在 <code>/usr/local/</code> 目录下，而 <code>/usr/bin/ld</code> 加载动态链接库时，根据 <code>/etc/ld.so.conf</code> 里面的配置, 先在 <code>/usr/local/lib</code> 目录查找。根据上面的错提示，此版本的 openssl 需要用 <code>-fPIC</code> 参数重新编译才行。 </p>
<ul>
<li>用 <code>-fPIC</code> 参数重新编译 openssl; </li>
<li>编辑 <code>/etc/ld.so.conf</code>，将 <code>/usr/local/lib</code> 和 <code>/usr/local/lib64</code> 两行换到该文件末尾。完了再换回来，否则影响其他自编译安装的动态库的加载顺序。</li>
</ul>
<p>当然，一劳永逸的方法，就是重新编译 openssl 了。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/08/generic-functions-with-single-dispatch/" itemprop="url">
                Generic Functions with Single Dispatch
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-09-08T00:00:00+08:00" content="2015-09-08">
            2015-09-08
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Python/" itemprop="url" rel="index">
                  <span itemprop="name">Python</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/09/08/generic-functions-with-single-dispatch/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/09/08/generic-functions-with-single-dispatch/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>众所周知， Python 不支持函数重载，因此无法创建一个通用函数，针对不同的参数类型作出不同的处理。例如，创建一个函数 <code>htmlize</code>，接受一个任意类型的 Python 对象作为参数，根据不同的参数类型，将其“序列化”为不同的 HTML 格式：</p>
<ul>
<li>默认使用<code>&lt;pre&gt;</code>标签;</li>
<li><code>str</code>: 将换行符替换为’<br>\n’，然后将其放在<code>&lt;p&gt;</code>标签中;</li>
<li><code>int</code>: 同时显示 10 进制和 16 进制，如： 12 (0xC);</li>
<li><code>list</code>: 以 HTML 列表的形式显示，每个元素按其类型分别格式化。</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; htmlize(&#123;1, 2, 3&#125;)</span><br><span class="line">'&lt;pre&gt;&#123;1, 2, 3&#125;&lt;/pre&gt;'</span><br><span class="line">&gt;&gt;&gt; htmlize(abs)</span><br><span class="line">'&lt;pre&gt;&amp;lt;built-in function abs&amp;gt;&lt;/pre&gt;'</span><br><span class="line">&gt;&gt;&gt; htmlize('Heimlich &amp; Co.\n- a game')</span><br><span class="line">'&lt;p&gt;Heimlich &amp;amp; Co.&lt;br&gt;\n- a game&lt;/p&gt;'</span><br><span class="line">&gt;&gt;&gt; htmlize(42)</span><br><span class="line">'&lt;pre&gt;42 (0x2a)&lt;/pre&gt;'</span><br><span class="line">&gt;&gt;&gt; print(htmlize(['alpha', 66, &#123;3, 2, 1&#125;]))</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;li&gt;&lt;p&gt;alpha&lt;/p&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;pre&gt;66 (0x42)&lt;/pre&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;pre&gt;&#123;1, 2, 3&#125;&lt;/pre&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p>常见的做法是同<code>if/elif/elif</code>结构，针对不同类型，分别调用相应的“序列化”函数。这样做主要的问题是缺乏灵活性和可扩展性。Python 3.4 引入的 <code>functools.singledispatch</code> 装饰器，可以使普通函数，成为通用函数(generic function)，达到像 <code>C++</code> 函数重载的效果。Python 3.3及以下的版本，在 PyPI 上有 <a href="https://pypi.python.org/pypi/singledispatch" target="_blank" rel="external">singledispatch</a> 包提供相应功能。</p>
<p>于是，其实现如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3 -tt</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> singledispatch</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> abc</span><br><span class="line"><span class="keyword">import</span> numbers</span><br><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line"><span class="decorator">@singledispatch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">htmlize</span><span class="params">(obj)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;pre&gt;&#123;0&#125;&lt;/pre&gt;'</span>.format(html.escape(repr(obj)))</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="decorator">@htmlize.register(str)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(text)</span>:</span></span><br><span class="line">    content = html.escape(text).replace(<span class="string">'\n'</span>, <span class="string">'&lt;br&gt;\n'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;p&gt;&#123;0&#125;&lt;/p&gt;'</span>.format(content)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="decorator">@htmlize.register(numbers.Integer)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&#123;0&#125; (0x&#123;0:X&#125;)'</span>.format(num)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="decorator">@htmlize.register(tuple)</span></span><br><span class="line"><span class="decorator">@htmlize.register(abc.MutableSequence)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span><span class="params">(seq)</span>:</span></span><br><span class="line">    inner = <span class="string">'&lt;/li&gt;\n&lt;li&gt;'</span>.join(htmlize(item) <span class="keyword">for</span> item <span class="keyword">in</span> seq)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;ul&gt;\n&lt;li&gt;&#123;0&#125;&lt;/li&gt;\n&lt;/ul&gt;'</span>.format(inner)</span><br></pre></td></tr></table></figure>
<p>上述例子来自《O’Reilly Fluent Python》, <a href="https://www.python.org/dev/peps/pep-0443/" target="_blank" rel="external">PEP 443</a> 对 <code>singledispatch</code> 有详细描述。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/02/scraping-with-javascript/" itemprop="url">
                Scraping with JavaScript
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-09-02T00:00:00+08:00" content="2015-09-02">
            2015-09-02
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Python/" itemprop="url" rel="index">
                  <span itemprop="name">Python</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/09/02/scraping-with-javascript/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/09/02/scraping-with-javascript/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>JavaScript 是目前使用最广泛的客户端脚本语言，越来越多的站点通过 JavaScript 来实现页面动态加载。<a href="http://blog.jquery.com/2014/01/13/the-stateof-jquery-2014/" target="_blank" rel="external">有统计显示</a>，全球最受欢迎的站点中，有 70% 都使用了 jQuery，一个非常流行的用于DOM操作的JavaScript库。在抓取这类站点时，采用传统的，直接解析HTML页面的方式就行不通了。此时，你会发现通过Python获取到的页面内容，与在浏览器里看到的截然不同；另外，有时 JavaScript 加载页面会有页面重定向，而只有当重定向发生时，页面 URL 才会发生变化。网络爬虫就会抓取失败。So, Ajax or DHTML? </p>
<p>解决方案只有两个：</p>
<ul>
<li>直接从 JavaScript 中抓取感兴趣的内容</li>
<li>在 Python 中执行相应的 JavaScript，在抓取内容</li>
</ul>
<p>这里就需要用到两个非常强大的工具了：<a href="http://www.seleniumhq.org/" target="_blank" rel="external">Selenium</a> 和 <a href="http://phantomjs.org/" target="_blank" rel="external">PhantomJS</a>。Selenium 本身不自带浏览器，所以在使用时会自动加载一个浏览器实例。而 PhantomJS 号称 “headless” browser，在加载页面并执行 JavaScript 时，并不会将页面渲染成图形展示出来。而在结合使用，堪称神器。</p>
<p>具体使用实例，且听下回分解。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/08/09/advanced-ssh-security-tips-and-tricks/" itemprop="url">
                增强 SSH 安全性的一些技巧
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-09T00:00:00+08:00" content="2015-08-09">
            2015-08-09
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Linux/" itemprop="url" rel="index">
                  <span itemprop="name">Linux</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/08/09/advanced-ssh-security-tips-and-tricks/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/08/09/advanced-ssh-security-tips-and-tricks/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>通常需要修改 SSH 服务器的配置文件<code>/etc/ssh/sshd_conf</code> 来增强其安全性，然后重启 SSH 服务器使之生效。</p>
<p>###1. 更改默认端口</p>
<p>SSH 的默认监听 22 端口，将其修改为大于 1024 的端口号，有助于提高 SSH 安全性，因为一些端口扫描工具不会扫描大于 1024 的端口。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Port 22</span></span><br><span class="line">Port <span class="number">4096</span></span><br></pre></td></tr></table></figure>
<p>###2. 只允许 SSH protocol 2</p>
<p>SSH 协议有两个版本，然而版本 1 存在一些<a href="http://en.wikipedia.org/wiki/Ssh#Security_cautions" target="_blank" rel="external">安全隐患</a>，包括<a href="http://en.wikipedia.org/wiki/Man_in_the_middle" target="_blank" rel="external">中间人攻击</a>和<a href="http://www.securityspace.com/smysecure/catid.html?id=10268" target="_blank" rel="external">注入攻击</a>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Protocol 2,1</span></span><br><span class="line">Protocol <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>###3. 只允许指定用户通过 SSH 登录</p>
<p>首先，应该禁止 root 用户通过 SSH 登录系统,需要 root 权限时使用 <code>sudo</code> 或 <code>su</code>命令来获取；然后，指定允许登录的用户。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PermitRootLogin yes</span></span><br><span class="line">PermitRootLogin no</span><br><span class="line">AllowUsers john alice bob</span><br></pre></td></tr></table></figure>
<p>###4. 使用 DSA 公钥授权 </p>
<p>DSA 公钥授权方式，由于不需要用户名和密码，可以避免字典攻击(dictionary attacks)。<br>首先，在 client 端用命令<code>ssh-keygen -t dsa</code> 生成私钥-公钥对， Private Key: ~/.ssh/id_dsa， Public Key: ~/.ssh/id_dsa.pub。<br>然后用<code>ssh-copy-id -p port user@hostname</code> 将公钥复制到 SSH Server。<br>配置 SSH server 使用DSA 授权,同时取消用户名密码授权：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PasswordAuthentication no</span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile %h/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>###5. 用 TCP wrappers 限定可连接的主机</p>
<p>当只运行指定网络内的主机登录时，可以用 TCP wrappers 进行过滤。需编辑 <code>/etc/hosts.deny</code> 和 <code>/etc/hosts.allow</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo "sshd: ALL" &gt;&gt; /etc/hosts.deny</span></span><br><span class="line"><span class="comment"># echo "sshd: 192.168.1.0/24 192.168.5.123" &gt;&gt; /etc/hosts.allow</span></span><br></pre></td></tr></table></figure>
<p>###6. 用 iptables 限制 SSH 访问</p>
<p>可以与 TCP wrappers 同时使用。例如，只允许特定主机访问 SSH 服务并禁止其他主机访问：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -A INPUT -p tcp -m state --state NEW --source 193.180.177.13 --dport 22 -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A INPUT -p tcp --dport 22 -j DROP</span></span><br></pre></td></tr></table></figure>
<p>###7. SSH time-lock tricks</p>
<p>还可以使用不同的 iptables 参数，来实现特定时间内对 SSH 的访问控制，比如 <code>/second</code>, <code>/minute</code>, <code>/hour</code> 或 <code>/day</code>。</p>
<p>例1. 实现输入错误密码后锁定 1 分钟，此后每分钟内只允许尝试 1 次：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -A INPUT -p tcp -m state --syn --state NEW --dport 22 -m limit --limit 1/minute --limit-burst 1 -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A INPUT -p tcp -m state --syn --state NEW --dport 22 -j DROP</span></span><br></pre></td></tr></table></figure>
<p>例2. 实现只允许 192.168.1.101 主机连接 SSH 服务，连续 3 次登录错误后，每分钟只允许尝试 1 次：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iptables -A INPUT -p tcp -s 193.180.177.13 -m state --syn --state NEW --dport 22 -m limit --limit 1/minute --limit-burst 3 -j ACCEPT</span></span><br><span class="line"><span class="comment"># iptables -A INPUT -p tcp -s 193.180.177.13 -m state --syn --state NEW --dport 22 -j DROP</span></span><br></pre></td></tr></table></figure>
<p>本文参考：<a href="https://www.linux.com/learn/tutorials/305769-advanced-ssh-security-tips-and-tricks" target="_blank" rel="external">https://www.linux.com/learn/tutorials/305769-advanced-ssh-security-tips-and-tricks</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/07/13/the-first-sight-on-meteor/" itemprop="url">
                初识 Meteor
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-07-13T00:00:00+08:00" content="2015-07-13">
            2015-07-13
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Meteor/" itemprop="url" rel="index">
                  <span itemprop="name">Meteor</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/07/13/the-first-sight-on-meteor/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/07/13/the-first-sight-on-meteor/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>最近发现了个很有趣、很强大的东西 <a href="https://www.meteor.com" target="_blank" rel="external">Meteor</a>，这一个构建在 Node.js 和 MongoDB 之上的，用于构建 Web 端和移动端实时应用的 Full Stack 开源平台。Meteor 位于程序数据库和用户界面之间,保持二者之间的数据同步更新。Meteor 在客户端和服务器端都使用 JavaScript 作为开发语言，因此代码能在前后两端共用。Meteor 还有活跃的社区和丰富的<a href="https://atmospherejs.com/" target="_blank" rel="external">第三方packages</a> 支持。</p>
<p>Meteor 的安装非常简单，只需要一条命令(当然是在已经安装了 Node.js 的情况下，否则先安装 Node.js)：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://install.meteor.com/ | sh</span><br></pre></td></tr></table></figure>
<p>安装好之后，就可以用来构建有趣的应用了。Meteor 自带了几个样例可以试用、参考。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ meter create --list</span><br><span class="line">Available examples:</span><br><span class="line">  clock</span><br><span class="line">  leaderboard</span><br><span class="line">  localmarket</span><br><span class="line">  todos</span><br><span class="line"></span><br><span class="line">Create a project from an example with <span class="string">'meteor create --example &lt;name&gt;'</span>.</span><br></pre></td></tr></table></figure>
<p>其中，<code>todos</code> 是一个 Todos 应用， 列出了 Meteor 的主要特性。按照上面提示创建 Todos， 并运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ meter create --example todos</span><br><span class="line">$ <span class="built_in">cd</span> todos</span><br><span class="line">$ meteor</span><br><span class="line">[[[[[ ~/program/meteor/todos ]]]]]</span><br><span class="line"></span><br><span class="line">=&gt; Started proxy.</span><br><span class="line">=&gt; Started MongoDB.</span><br><span class="line">=&gt; Started your app.</span><br><span class="line"></span><br><span class="line">=&gt; App running at: http://localhost:<span class="number">3000</span>/</span><br></pre></td></tr></table></figure>
<p>在浏览器打开<code>http://localhost:3000/</code>：</p>
<p><img src="https://raw.githubusercontent.com/husless/husless.github.io/master/images/meter-todos.png" alt="Meteor todos"></p>
<ul>
<li><p>Data on the Wire. Meteor 并不在网络上发生HTML，而是将一切‘编译’成 <code>JavaScript</code> 和 <code>CSS</code> 再交给 Client(比如浏览器) 渲染。</p>
</li>
<li><p>One Language. Meteor 在 Server 和 Client 端都用 <code>JavaScript</code>。</p>
</li>
<li><p>Database Everywhere. Meteor 的 Client 端有自己的 Database–Minimongo，Client 只与自己本地的 Minimongo 进行数据交互。Meteor 使用一种 Pub/Sub 模型来控制 MongoDB 服务器与 Minimongo 客户端之间同步的数据。默认情况下，所有服务器端 Meteor 集合都会被发布。Meteor 使用 DDP（Distributed Data Protocol，分布式数据协议）在客户端与服务器之间移动数据。</p>
</li>
<li><p>Latency Compensation. 在 Client 端，Meteor 会预抓取(prefetch)数据，然后模拟出像是 Server 端及时响应过来的。Minimongo 使用 latency compensation 来反映数据库更改，从根本上讲，延迟补偿是大数据管理领域中的 最终一致性概念的一种视觉表现。当通过 Minimongo stub 更新客户端上的数据时，任何更改都会立即在客户端上反映出来，包括反应性重新呈现。这些更改还会被传播到服务器。但是，传播的更改可能会失败，失败的原因有很多，包括拒绝访问。Pub/Sub 机制负责确保客户端最终(通常很快)反映了服务器的实际状态。延迟补偿可实现一种无需等待的、响应非常迅速的 UI，这是现代 Web 2.0 应用程序的一个鲜明特征。而代价可能是出现短暂的视觉数据不一致性。 </p>
</li>
<li><p>Full Stack Reactivity.  Meteor 中从数据库(database)到模板层(template)一切变化都是实时的，任何更新都会自动同步。</p>
</li>
<li><p>Embrace the Ecosystem. Meteor 是一个开源平台，同时集成了许多优秀的开源工具和框架，比如能通过命令 <code>meteor add-platform android</code> 和 <code>meteor add-platform ios</code> 分别添加 Android 和 iOS 模拟器。</p>
</li>
<li><p>Simplicity Equals Productivity.</p>
</li>
</ul>
<p>与传统的LAMP(或LEMP)架构不同，Meteor 实际上采用 Pub/Sub 机制，以 Database Everywhere方式，在 Server 端为 MongoDB，在 Client 端为 Minimongo；借助 <a href="https://developer.mozilla.org/en-US/docs/WebSockets" target="_blank" rel="external">Websocket</a> 在 Server 端和 Client 端之间实现永久连接；Client 只与本地 Minimongo进行数据操作，因此速度非常快，同时以 Ajax 方式通过 Websocket 与 Server实现数据同步。</p>
<p>Meteor 是如此的强大，它将当前最新、最先进技术组合起来，使用起来却非常方便快捷，非常值得学习和使用。而本文只是对 Meteor 的简单介绍，还需要对其进一步深入的学习和使用。</p>
<p>主要的学习资料：</p>
<ul>
<li><a href="http://docs.meteor.com/#/basic/" target="_blank" rel="external">官方文档</a>当然通常都是最权威的；</li>
<li>Meteor 开发者团队出的 <a href="https://www.discovermeteor.com" target="_blank" rel="external">Discover Meteor</a> 也是非常值得推荐的资料；</li>
<li><a href="https://forums.meteor.com/" target="_blank" rel="external">Meteor Forums</a>；</li>
<li>使用，并在 <a href="https://github.com/meteor/meteor/wiki/Contributing-to-Meteor" target="_blank" rel="external">Gitgub 上为 Meteor 贡献代码</a>。</li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/07/11/what-is-a-metaclass-in-python/" itemprop="url">
                What Is a Metaclass In Python
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-07-11T00:00:00+08:00" content="2015-07-11">
            2015-07-11
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Python/" itemprop="url" rel="index">
                  <span itemprop="name">Python</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/07/11/what-is-a-metaclass-in-python/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/07/11/what-is-a-metaclass-in-python/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>Python中关于metaclass的问题，Stack overflow上有一相当精彩的描述：</p>
<p><a href="http://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python" target="_blank" rel="external">http://stackoverflow.com/questions/100003/what-is-a-metaclass-in-python</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/07/03/matlab-automatic-broadcasting-operation-applied/" itemprop="url">
                Matlab Automatic Broadcasting Operation Applied
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-07-03T00:00:00+08:00" content="2015-07-03">
            2015-07-03
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Matlab/" itemprop="url" rel="index">
                  <span itemprop="name">Matlab</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/07/03/matlab-automatic-broadcasting-operation-applied/#comments" itemprop="discussionUrl">
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/07/03/matlab-automatic-broadcasting-operation-applied/" itemprop="commentsCount"></span>
            </a>
          </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>在使用 Matlab 做 machine learning 练习时，将两个不同维度的矩阵相减，结果正确但出现了如下的警告：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">warning: operator -: automatic broadcasting operation applied</span><br></pre></td></tr></table></figure>
<p>出现此警告的根源在于两个矩阵的维度不一致。</p>
<p>但，我们知道，在Matlab中一个矩阵与一个实数进行四则运算，实际上是对矩阵的没一个矩阵元做相应的运算。那么，是否可以对此规则进行推广呢？比如，一个$M \times N$ 的矩阵 A 减去一个 $1 \times N$ 的向量 b，就相当于用 A 的每一行与 b 相减，它们之间维度一致，可以进行计算，结果也符合我们的期望。 For example,</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">octave:<span class="number">3</span>&gt; a</span><br><span class="line">a =</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>   <span class="number">3</span></span><br><span class="line"><span class="number">1</span>   <span class="number">3</span></span><br><span class="line"><span class="number">1</span>   <span class="number">3</span></span><br><span class="line"><span class="number">1</span>   <span class="number">3</span></span><br><span class="line"><span class="number">1</span>   <span class="number">3</span></span><br><span class="line">octave:<span class="number">4</span>&gt; a - [<span class="number">1</span> <span class="number">2</span>]</span><br><span class="line">warning: <span class="keyword">operator</span> -: automatic broadcasting operation applied</span><br><span class="line">ans =</span><br><span class="line"></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>应该如何避免警告信息呢？ Google 了一番之后，在 <a href="http://stackoverflow.com/questions/18475627/automatic-broadcasting-operation-applied-on-equally-sized-matrices" target="_blank" rel="external">stackoverflow.com</a> 上发现同样的问题。Matlab 内置函数 <code>bsxfun</code> or <code>repmat</code> 可以解决这个问题。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">octave:<span class="number">5</span>&gt; a - repmat([<span class="number">1</span> <span class="number">2</span>], <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line">ans =</span><br><span class="line"></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"></span><br><span class="line">octave:<span class="number">6</span>&gt; bsxfun(@minus, a, [<span class="number">1</span> <span class="number">2</span>])</span><br><span class="line">ans =</span><br><span class="line"></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br><span class="line"><span class="number">0</span>   <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><code>bsxfun</code> 和 <code>repmat</code> 的具体用法，可以查阅文档，故不在此赘述。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">&raquo;</a>
  </nav>

 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="https://avatars1.githubusercontent.com/u/2921692?v=3&s=460" alt="Huszhi" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Huszhi</p>
        </div>
        <p class="site-description motion-element" itemprop="description">人生得意须尽欢， 莫使金樽空对月</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">20</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/husless" target="_blank">Github</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/huszhi" target="_blank">Twitter</a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp;  2014 - 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Huszhi</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'huszhi';
      var disqus_identifier = 'index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
